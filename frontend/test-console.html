<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JAN Delivery Console Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f0f0f0; }
        .console { background: #000; color: #0f0; padding: 15px; border-radius: 5px; white-space: pre; overflow-x: auto; margin: 10px 0; }
        .test { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { color: green; } .error { color: red; } .info { color: blue; }
    </style>
</head>
<body>
    <h1>JAN Delivery - Консольный тест</h1>
    
    <div class="test">
        <h3>Тест 1: Проверка загрузки скриптов</h3>
        <div id="script-test" class="console"></div>
    </div>
    
    <div class="test">
        <h3>Тест 2: Проверка API подключения</h3>
        <div id="api-test" class="console"></div>
    </div>
    
    <div class="test">
        <h3>Тест 3: Проверка i18n</h3>
        <div id="i18n-test" class="console"></div>
    </div>
    
    <script src="js/config.js"></script>
    <script src="js/telegram.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/api.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/menu.js"></script>

    <script>
    const log = (testId, message, type = 'info') => {
        const colors = { success: '#0f0', error: '#f00', info: '#fff' };
        const el = document.getElementById(testId);
        el.innerHTML += `<span style="color: ${colors[type]}">[${type.toUpperCase()}] ${message}</span>\n`;
        console.log(`[${testId}] ${message}`);
    };

    // Тест 1: Проверка скриптов
    log('script-test', 'Проверка загруженных объектов...');
    log('script-test', `CONFIG: ${typeof CONFIG}`, typeof CONFIG === 'object' ? 'success' : 'error');
    log('script-test', `telegram: ${typeof telegram}`, typeof telegram === 'object' ? 'success' : 'error');
    log('script-test', `window.i18n: ${typeof window.i18n}`, typeof window.i18n === 'object' ? 'success' : 'error');
    log('script-test', `api: ${typeof api}`, typeof api === 'object' ? 'success' : 'error');
    log('script-test', `cart: ${typeof cart}`, typeof cart === 'object' ? 'success' : 'error');
    log('script-test', `menuManager: ${typeof menuManager}`, typeof menuManager === 'object' ? 'success' : 'error');

    // Тест 2: API
    async function testAPI() {
        try {
            log('api-test', 'Тестирование API...');
            log('api-test', `API Base URL: ${api.baseUrl}`);
            
            const menu = await api.getMenu('ru');
            log('api-test', `Меню загружено: ${menu.length} блюд`, menu.length > 0 ? 'success' : 'error');
            
            if (menu.length > 0) {
                log('api-test', `Первое блюдо: ${menu[0].name} (${menu[0].category})`, 'success');
            }
            
            const categories = await api.getCategoriesStructure('ru');
            const catCount = Object.keys(categories).length;
            log('api-test', `Категории загружены: ${catCount} категорий`, catCount > 0 ? 'success' : 'error');
            
        } catch (error) {
            log('api-test', `Ошибка API: ${error.message}`, 'error');
        }
    }

    // Тест 3: i18n
    async function testI18n() {
        try {
            log('i18n-test', 'Тестирование i18n...');
            
            await window.i18n.init();
            log('i18n-test', `Текущий язык: ${window.i18n.getCurrentLanguage()}`, 'success');
            
            const testKey = 'app.loading';
            const translation = window.i18n.t(testKey);
            log('i18n-test', `Перевод "${testKey}": "${translation}"`, translation !== testKey ? 'success' : 'error');
            
            // Тест смены языка
            window.i18n.setLanguage('en');
            const englishTranslation = window.i18n.t(testKey);
            log('i18n-test', `English "${testKey}": "${englishTranslation}"`, englishTranslation !== testKey ? 'success' : 'error');
            
            window.i18n.setLanguage('ru'); // Обратно к русскому
            
        } catch (error) {
            log('i18n-test', `Ошибка i18n: ${error.message}`, 'error');
        }
    }

    // Запуск тестов
    setTimeout(() => {
        testAPI();
        testI18n();
    }, 1000);
    </script>
</body>
</html>