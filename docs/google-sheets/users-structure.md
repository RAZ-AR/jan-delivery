# Google Sheets - Структура листа "Users"

## Описание
Лист "Users" содержит информацию о всех пользователях Telegram Mini App для персонализации и улучшения сервиса.

## Структура колонок

| Колонка | Название | Тип данных | Обязательное | Описание |
|---------|----------|------------|--------------|----------|
| A | userId | TEXT | ✅ | Telegram ID пользователя |
| B | first_name | TEXT | ✅ | Имя пользователя |
| C | last_name | TEXT | ❌ | Фамилия пользователя |
| D | username | TEXT | ❌ | Telegram username (@username) |
| E | language_code | TEXT | ❌ | Код языка (ru, en) |
| F | phone | TEXT | ❌ | Номер телефона |
| G | address | TEXT | ❌ | Последний адрес доставки |
| H | createdAt | DATETIME | ✅ | Дата первого входа |
| I | updatedAt | DATETIME | ✅ | Дата последнего обновления |

## Пример заполнения

```
A         B      C       D          E  F              G                    H                   I
userId    first_name last_name username   language_code phone          address              createdAt           updatedAt
123456789 Иван   Петров  ivan_petrov    ru            +7(999)123-45-67 ул. Ленина, д. 15    2024-01-15 10:30:00 2024-01-15 14:30:00
987654321 Мария  Сидорова maria123       ru            +7(999)987-65-43 пр. Мира, д. 42      2024-01-15 11:15:00 2024-01-15 11:15:00
555666777 John   Smith   johnsmith      en            +7(999)555-66-77                      2024-01-15 12:00:00 2024-01-15 12:00:00
```

## Описание полей

### userId (Telegram ID)
- Уникальный числовой идентификатор пользователя в Telegram
- Всегда положительное число
- Используется как первичный ключ
- Не может быть изменен

### first_name (Имя)
- Имя пользователя из профиля Telegram
- Обязательное поле (всегда есть в Telegram)
- Может содержать эмодзи
- Автоматически обновляется при изменении в профиле

### last_name (Фамилия)
- Фамилия пользователя из профиля Telegram  
- Необязательное поле
- Может быть пустым если не указано в профиле
- Автоматически обновляется

### username (Имя пользователя)
- Username из Telegram без символа @
- Необязательное поле
- Может быть пустым
- Используется для упоминаний

### language_code (Язык)
- Код языка пользователя из Telegram
- Двухбуквенный код (ru, en, de, fr, etc.)
- По умолчанию: `ru`
- Используется для локализации

### phone (Телефон)
- Номер телефона пользователя
- Формат: `+7(999)123-45-67`
- Заполняется при первом заказе
- Используется для связи при доставке

### address (Адрес)
- Последний использованный адрес доставки
- Сохраняется для удобства при повторном заказе
- Может быть обновлен пользователем
- Строка в свободном формате

### createdAt (Дата создания)
- Дата и время первого входа в приложение
- Формат: `YYYY-MM-DD HH:MM:SS`
- Часовой пояс: UTC+3 (Москва)
- Устанавливается автоматически

### updatedAt (Дата обновления)
- Дата и время последнего обновления профиля
- Обновляется при изменении любых данных
- Формат: `YYYY-MM-DD HH:MM:SS`
- Используется для отслеживания активности

## Автоматическое управление

### Создание пользователя
При первом запуске приложения:
1. Проверяется существование userId в таблице
2. Если не найден - создается новая запись
3. Заполняются данные из Telegram профиля
4. Устанавливается createdAt и updatedAt

### Обновление профиля
При каждом запуске приложения:
1. Сравниваются данные из Telegram с сохраненными
2. При изменениях обновляется запись
3. Обновляется поле updatedAt
4. Сохраняются phone и address если были изменены

## Использование данных

### Персонализация
- Обращение по имени в уведомлениях
- Автозаполнение формы заказа
- Сохранение предпочтений доставки

### Аналитика
- Количество активных пользователей
- География использования (по адресам)
- Языковые предпочтения
- Время регистрации и активности

### Маркетинг
- Сегментация пользователей
- Персонализированные предложения
- Анализ оттока пользователей

## Правила работы

### Конфиденциальность
- Данные используются только для работы сервиса
- Не передаются третьим лицам
- Телефоны используются только для доставки
- Соблюдение GDPR и российского законодательства

### Безопасность
- Доступ только у авторизованного персонала
- Регулярное резервное копирование
- Защита от несанкционированного доступа

### Обслуживание
- Не удаляйте записи пользователей
- При блокировке добавьте отметку в комментарии
- Регулярно проверяйте корректность данных

## Статистические запросы

### Новые пользователи за период
```
=COUNTIFS(H:H,">="&DATE(2024,1,1),H:H,"<"&DATE(2024,2,1))
```

### Активные пользователи (обновления за последние 30 дней)
```
=COUNTIF(I:I,">="&TODAY()-30)
```

### Распределение по языкам
```
=COUNTIF(E:E,"ru")  // Русскоязычные
=COUNTIF(E:E,"en")  // Англоязычные
```

### Пользователи с сохраненными адресами
```
=COUNTA(G:G)-1  // Минус заголовок
```

## Интеграция с заказами

Данные пользователей автоматически подставляются в заказы:
- `userInfo` в Orders формируется из полей B, C, D
- `phone` берется из поля F при оформлении заказа
- `address` предзаполняется из поля G

## Резервное копирование

Рекомендуется:
- Еженедельное экспортирование в CSV
- Синхронизация с CRM системой
- Дублирование критически важных данных

## Примечания
- Все операции с данными логируются
- При изменении структуры таблицы обновите backend код
- Поле userId никогда не должно быть пустым
- Даты всегда в московском времени